namespace: monk-copilot-test

garden-journal-site:
  defines: netlify/site
  name: monk-monk-copilot-test-pla
  force_ssl: false
  secret_ref: default-netlify-pat
  permitted-secrets:
    default-netlify-pat: true
  services:
    data:
      protocol: custom
      container: main

garden-journal:
  defines: runnable
  inherits: netlify/deploy
  containers:
    deploy:
      paths:
        - "blobs://garden-journal:/home/node/app"
  variables:
    deploy-dir: dist
    site-id: <- connection-target("site") entity-state get-member("id")
    pre-deploy: |
      npm install
      npm run build
      
    netlify-adapter:
      type: string
      env: NETLIFY_ADAPTER
      description: Specifies the Netlify adapter for deployment.
      value: netlify
    astro-output:
      type: string
      env: ASTRO_OUTPUT
      description: "Defines the output mode for Astro, set to 'server' for server-side rendering."
      value: server
  connections:
    site:
      target: monk-copilot-test/garden-journal-site
      service: data
  depends:
    wait-for:
      runnables:
        - monk-copilot-test/garden-journal-site

stack:
  defines: group
  members:
    - monk-copilot-test/garden-journal-site
    - monk-copilot-test/garden-journal

